# == How do I use a 256 colour terminal? ==
# Provided the underlying terminal supports 256 colours,
# it is usually sufficient to add one of the following to ~/.tmux.conf:
#   > default-terminal terminal
#   >   Set the default terminal for new windows created in this session - the
#   >   default value of the TERM environment variable.  For tmux to work
#   >   correctly, this must be set to ‘screen’, ‘tmux’ or a derivative of them.

# set-option -g default-terminal "screen-256color"
set-option -g default-terminal "tmux-256color"
# set-option -g default-terminal "xterm-256color"

# 24ビットカラー
# == How do I use RGB colour? ==
# tmux must be told that the terminal outside supports RGB colour.
# This is done by specifying the RGB or Tc terminfo(5) flags.
# RGB is the official flag, Tc is a tmux extension.
# With tmux 3.2 and later this can be added with the terminal-features option:
set-option -as terminal-features ",*256color*:RGB"
# Or for any tmux version the terminal-overrides option:
set-option -ga terminal-overrides ",*256col*:Tc"

# == Why are tmux pane separators dashed rather than continuous lines? ==
# Some terminals or certain fonts (particularly some Japanese fonts)
# do not correctly handle UTF-8 line drawing characters.
# The U8 capability forces tmux to use ACS instead of UTF-8 line drawing:
set-option -as terminal-overrides ',*:U8=0'

set-option -g default-shell   "${SHELL}"
set-option -g default-command "${SHELL}"

set-option -g history-limit 10000

set-option -g status-interval 10 # 単位は秒

set-option -s escape-time 0

# ウィンドウとペインの番号を1から開始する（デフォルト0）
set-option        -g base-index        1
set-window-option -g pane-base-index   1
set-option        -g renumber-windows  on

# クリップボード連携
set-option -g set-clipboard external

# nvim advice
set-option -g focus-events on

#==============================================================================
# keybind
#==============================================================================
unbind-key C-b
set-option -g prefix C-t
bind-key C-t send-prefix

# bind-key Space copy-mode
bind-key p paste-buffer

## vi-like keybind
set-window-option -g mode-keys vi
bind-key -r h select-pane -L
bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r l select-pane -R
bind-key -T copy-mode-vi V      send-keys -X select-line
bind-key -T copy-mode-vi v      send-keys -X begin-selection
bind-key -T copy-mode-vi Escape send-keys -X clear-selection
bind-key -T copy-mode-vi y      send-keys -X copy-pipe-and-cancel
bind-key -T copy-mode-vi Y {
  send-keys -X select-line
  send-keys -X copy-pipe-and-cancel
}
# if-shell "uname | grep -q Darwin" {
#   bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel
# }
# bind-key -T copy-mode-vi Space  send-keys -X halfpage-down
# bind-key -T copy-mode-vi Bspace send-keys -X halfpage-up

# ペインサイズを上下左右（Prefix+JKHL）に変更
# Prefix+J,J,J,J,...と連打してリサイズ可能
#   * リサイズの単位は%
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

bind-key \\ split-window -h -c '#{pane_current_path}'
bind-key |  split-window -h -c '#{pane_current_path}'
bind-key -  split-window -v -c '#{pane_current_path}'

# マウススクロールの有効化
set-option -g  mouse on
set-option -gw alternate-screen on

# 設定ファイルをリロードする
bind-key r {
  source-file ${XDG_CONFIG_HOME}/tmux/tmux.conf
  display-message "tmux reloaded."
}

#==============================================================================
# define colour
#==============================================================================
set -g @colorscheme "yellow"

if-shell "[ '#{@colorscheme}' = 'green' ]" {
  # green
  set -g @base-fg   "#1a9b69"
  set -g @base-bg   "#001109"
  set -g @bright-fg "#49ffb8"
  set -g @dimmed-bg "#0a1820"
}
if-shell "[ '#{@colorscheme}' = 'blue' ]" {
  # blue
  set -g @base-fg   "#1fa2a2"
  set -g @base-bg   "#001111"
  set -g @bright-fg "#4affff"
  set -g @dimmed-bg "#0a1820"
}
if-shell "[ '#{@colorscheme}' = 'yellow' ]" {
  # yellow
  set -g @base-fg   "#a88b19"
  set -g @base-bg   "#110e00"
  set -g @bright-fg "#ffe03b"
  set -g @dimmed-bg "#0a1820"
}
if-shell "[ '#{@colorscheme}' = 'orange' ]" {
  # orange
  set -g @base-fg   "#a26729"
  set -g @base-bg   "#110700"
  set -g @bright-fg "#ffa340"
  set -g @dimmed-bg "#0a1820"
}

# set -g @base-fg   "#029b60"
# set -g @base-bg   "#002212"
# set -g @bright-fg "#00ff9c"

# set -g @base-fg   "#008f11"
# set -g @base-bg   "#003b00"
# set -g @bright-fg "#00ff41"

#==============================================================================
# ssh check
#==============================================================================
if-shell -F "${SSH_CONNECTION}" {
  set -g @ssh-symbol "󰖟 ssh"
} {
  # set -g @ssh-symbol "󰟀 local"
  set -g @ssh-symbol ""
}
# 󰌢  󰟀  󰇄

#==============================================================================
# status line
#==============================================================================
# set-option -g status-style bg="#3c3836",fg=colour250
set-option -gF status-style "bg=#{@base-bg},fg=#{@base-fg}"

#-------------
# left
#-------------
set-option -g   status-left-length 15
# set-option -g status-left "#[bg=default,fg=default]  [#P:#{window_panes}]  "
set-option -gw  status-left "#[bg=default,fg=default bold] #S:              "
# set-option -gw  status-left "#[bg=default,fg=default bold]  #S             "

#-------------
# center
#-------------
# window status
set-option -g   status-justify left
set-option -gwF window-status-style          bg=default,fg=default
set-option -gwF window-status-current-style "bg=default,fg=#{@bright-fg},bold"
# set-option -gw  window-status-format         " #I. #W#F "
set-option -gw  window-status-format         " #I. #W "
set-option -gw  window-status-current-format " #I. #W "

#-------------
# right
#-------------
set-option -g  status-right-length 40
# set-option -g status-right "#[fg=brightwhite]#{?S,#S,}  #[fg=brightblue,bold]${OS_ICON}#h  #[fg=white,nobold]%Y-%m-%d %H:%M "
# set-option -g status-right "#[fg=brightwhite]#{?S,#S,}  #[fg=colour109,bold]${OS_ICON}#h  #[fg=colour250,nobold]%Y-%m-%d %H:%M "
set-option -gF status-right \
  "#{@ssh-symbol}  #[fg=#{@bright-fg},bold]${OS_ICON}#h  #[fg=default,nobold]%Y-%m-%d %H:%M  "

#==============================================================================
# Misc
#==============================================================================
# Pane border
# set-option -g pane-border-style        bg=default,fg=default
# set-option -g pane-active-border-style bg=default,fg=blue
set-option -g  pane-border-style        "bg=default,fg=gray"
set-option -gF pane-active-border-style "bg=default,fg=#{@base-fg}"

# Pane number indicator
set-option -g  display-panes-colour        gray
set-option -gF display-panes-active-colour "#{@bright-fg}"

# Clock mode
set-option -gF clock-mode-colour "#{@base-fg}"
set-option -g  clock-mode-style  24

# window style - content style
# set-option -g window-style        bg=colour236,fg=default
set-option -gF window-style        "bg=#{@dimmed-bg},fg=default" # for OceanicNext
set-option -gF window-active-style "bg=terminal,fg=default"

# message
set-option -gF message-style         "bg=#{@base-bg},fg=#{@bright-fg}"
set-option -gF message-command-style "bg=#{@base-bg},fg=#{@bright-fg}"

# コピーモードのときに、右上に出てくる表示の色
set-option -gF mode-style "bg=#{@base-bg} fg=#{@bright-fg} reverse"

